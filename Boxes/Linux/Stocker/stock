<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="" />
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors" />
    <meta name="generator" content="Hugo 0.84.0" />
    <title>Stockers</title>

    <!-- Bootstrap core CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />

    <style>
      .bd-placeholder-img {
        font-size: 1.125rem;
        text-anchor: middle;
        -webkit-user-select: none;
        -moz-user-select: none;
        user-select: none;
      }

      @media (min-width: 768px) {
        .bd-placeholder-img-lg {
          font-size: 3.5rem;
        }
      }
    </style><!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="" />
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors" />
    <meta name="generator" content="Hugo 0.84.0" />
    <title>Stockers</title>

    <!-- Bootstrap core CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />

    <style>
      .bd-placeholder-img {
        font-size: 1.125rem;
        text-anchor: middle;
        -webkit-user-select: none;
        -moz-user-select: none;
        user-select: none;
      }

      @media (min-width: 768px) {
        .bd-placeholder-img-lg {
          font-size: 3.5rem;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <div class="navbar navbar-dark bg-dark shadow-sm">
        <div class="container">
          <a href="#" class="navbar-brand d-flex align-items-center">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-receipt" viewBox="0 0 16 16">
              <path
                d="M1.92.506a.5.5 0 0 1 .434.14L3 1.293l.646-.647a.5.5 0 0 1 .708 0L5 1.293l.646-.647a.5.5 0 0 1 .708 0L7 1.293l.646-.647a.5.5 0 0 1 .708 0L9 1.293l.646-.647a.5.5 0 0 1 .708 0l.646.647.646-.647a.5.5 0 0 1 .708 0l.646.647.646-.647a.5.5 0 0 1 .801.13l.5 1A.5.5 0 0 1 15 2v12a.5.5 0 0 1-.053.224l-.5 1a.5.5 0 0 1-.8.13L13 14.707l-.646.647a.5.5 0 0 1-.708 0L11 14.707l-.646.647a.5.5 0 0 1-.708 0L9 14.707l-.646.647a.5.5 0 0 1-.708 0L7 14.707l-.646.647a.5.5 0 0 1-.708 0L5 14.707l-.646.647a.5.5 0 0 1-.708 0L3 14.707l-.646.647a.5.5 0 0 1-.801-.13l-.5-1A.5.5 0 0 1 1 14V2a.5.5 0 0 1 .053-.224l.5-1a.5.5 0 0 1 .367-.27zm.217 1.338L2 2.118v11.764l.137.274.51-.51a.5.5 0 0 1 .707 0l.646.647.646-.646a.5.5 0 0 1 .708 0l.646.646.646-.646a.5.5 0 0 1 .708 0l.646.646.646-.646a.5.5 0 0 1 .708 0l.646.646.646-.646a.5.5 0 0 1 .708 0l.646.646.646-.646a.5.5 0 0 1 .708 0l.509.509.137-.274V2.118l-.137-.274-.51.51a.5.5 0 0 1-.707 0L12 1.707l-.646.647a.5.5 0 0 1-.708 0L10 1.707l-.646.647a.5.5 0 0 1-.708 0L8 1.707l-.646.647a.5.5 0 0 1-.708 0L6 1.707l-.646.647a.5.5 0 0 1-.708 0L4 1.707l-.646.647a.5.5 0 0 1-.708 0l-.509-.51z"
              />
              <path
                d="M3 4.5a.5.5 0 0 1 .5-.5h6a.5.5 0 1 1 0 1h-6a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h6a.5.5 0 1 1 0 1h-6a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h6a.5.5 0 1 1 0 1h-6a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5zm8-6a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5z"
              />
            </svg>
            <strong>&nbsp;Stockers</strong>
            <a href="/logout" class="text-light">Logout</a>
          </a>
        </div>
      </div>
    </header>

    <main>
      <section class="py-5 text-center container">
        <div class="row py-lg-5">
          <div class="col-lg-6 col-md-8 mx-auto">
            <h1 class="fw-light">Buy Stock Now!</h1>
            <p class="lead text-muted">
              Our products are some of the highest quality products about. Our on-demand customer support will help you at every stage,
              helping you make money and win your customers over.
            </p>
            <p>
              <a href="#" class="btn btn-primary my-2" data-bs-toggle="modal" data-bs-target="#cart-modal">View Cart</a>
            </p>
          </div>
        </div>
      </section>

      <div class="album py-5 bg-light">
        <div class="container">
          <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3" id="item-container"></div>
        </div>
      </div>
    </main>

    <footer class="text-muted py-5">
      <div class="container">
        <p class="float-end mb-1">
          <a href="#">Back to top</a>
        </p>
      </div>
    </footer>

    <template id="product-template">
      <div class="col">
        <div class="card shadow-sm">
          <img width="100%" height="100%" class="card-img-top item-image" src="" />

          <div class="card-body">
            <p class="card-text">
              <strong class="item-title"></strong><br />
              <span class="item-description"> </span>
            </p>
            <small class="text-muted item-stock"></small>

            <div class="d-flex justify-content-between align-items-center">
              <small class="text-muted item-price"></small>
              <div class="btn-group">
                <button type="button" class="btn btn-sm btn-outline-secondary add-to-basket">Add to Basket</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </template>

    <template id="basket-template">
      <tr class="basket-item">
        <td class="item-name"></td>
        <td class="item-price"></td>
        <td class="item-quantity"></td>
      </tr>
    </template>

    <div class="modal" id="cart-modal" tabindex="-1">
      <div class="modal-dialog modal-xl">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Your Cart</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div id="before-purchase">
              <table class="table table-striped">
                <thead>
                  <tr>
                    <th scope="col">Item</th>
                    <th scope="col">Price (£)</th>
                    <th scope="col">Quantity</th>
                  </tr>
                </thead>
                <tbody id="cart-table">
                  <tr>
                    <th scope="col">Total</th>
                    <th scope="col" id="cart-total"></th>
                    <th scope="col"></th>
                  </tr>
                </tbody>
              </table>
            </div>
            <div id="after-purchase" style="display: none">
              <h1>Thank you for your purchase!</h1>
              <p><strong>Order ID: </strong><span id="order-id"></span></p>
              <p>
                Your order details have been emailed to you. You can view the purchase order
                <a id="purchase-order-link" target="_blank" rel="noopener">here.</a>
              </p>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" id="submit-purchase">Submit Purchase</button>

            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
  </body>

  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
    crossorigin="anonymous"
  ></script>

  <script>
    const $ = (selector) => document.querySelector(selector);

    const basket = [];

    let productStore = [];

    const cartModalElement = $("#cart-modal");
    const cartModal = new bootstrap.Modal(cartModalElement);

    fetch("/api/products")
      .then((response) => response.json())
      .then((products) => {
        productStore = products;
        const template = $("#product-template");

        products.forEach((product) => {
          const clone = template.content.cloneNode(true);
          const $$ = (selector) => clone.querySelector(selector);

          $$(".item-title").textContent = product.title;
          $$(".item-description").textContent = product.description;
          $$(".item-price").textContent = `£${product.price.toFixed(2)}`;
          $$(".item-stock").textContent = `${product.currentStock} In Stock`;
          $$(".item-image").setAttribute("src", `/static/img/${product.image}`);
          $$(".add-to-basket").setAttribute("product-id", product._id);

          $("#item-container").appendChild(clone);
        });

        Array.from(document.querySelectorAll(".add-to-basket")).forEach((button) => {
          button.addEventListener("click", () => {
            const product = productStore.find((product) => product._id === button.getAttribute("product-id"));

            if (!product) return;

            const existing = basket.find((basketItem) => basketItem._id === product._id);
            if (existing) {
              existing.amount++;
            } else {
              basket.push({ ...product, amount: 1 });
            }

            alert("Added to basket!");
            console.log(basket);
          });
        });
      });

    const beforePurchase = $("#before-purchase");
    const afterPurchase = $("#after-purchase");
    const cartTable = $("#cart-table");
    const submitPurchase = $("#submit-purchase");

    const purchaseOrderLink = $("#purchase-order-link");

    cartModalElement.addEventListener("show.bs.modal", () => {
      beforePurchase.style.display = "";
      afterPurchase.style.display = "none";

      document.querySelectorAll(".basket-item").forEach((item) => item.remove());

      const template = $("#basket-template");

      basket.forEach((basketItem) => {
        const clone = template.content.cloneNode(true);

        const $$ = (selector) => clone.querySelector(selector);

        $$(".item-name").textContent = basketItem.title;

        $$(".item-quantity").textContent = basketItem.amount;
        $$(".item-price").textContent = `£${basketItem.price.toFixed(2)}`;

        cartTable.prepend(clone);
      });

      $("#cart-total").textContent = basket
        .map((x) => x.price * x.amount)
        .reduce((a, b) => a + b, 0)
        .toFixed(2);

      if (basket.length > 0) {
        submitPurchase.style.display = "";
      } else {
        submitPurchase.style.display = "none";
      }
    });

    submitPurchase.addEventListener("click", () => {
      fetch("/api/order", {
        method: "POST",
        body: JSON.stringify({ basket }),
        headers: {
          "Content-Type": "application/json",
        },
      })
        .then((response) => response.json())
        .then((response) => {
          if (!response.success) return alert("Something went wrong processing your order!");

          purchaseOrderLink.setAttribute("href", `/api/po/${response.orderId}`);

          $("#order-id").textContent = response.orderId;

          beforePurchase.style.display = "none";
          afterPurchase.style.display = "";
          submitPurchase.style.display = "none";
        });
    });
  </script>
</html>

  </head>
  <body>
    <header>
      <div class="navbar navbar-dark bg-dark shadow-sm">
        <div class="container">
          <a href="#" class="navbar-brand d-flex align-items-center">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-receipt" viewBox="0 0 16 16">
              <path
                d="M1.92.506a.5.5 0 0 1 .434.14L3 1.293l.646-.647a.5.5 0 0 1 .708 0L5 1.293l.646-.647a.5.5 0 0 1 .708 0L7 1.293l.646-.647a.5.5 0 0 1 .708 0L9 1.293l.646-.647a.5.5 0 0 1 .708 0l.646.647.646-.647a.5.5 0 0 1 .708 0l.646.647.646-.647a.5.5 0 0 1 .801.13l.5 1A.5.5 0 0 1 15 2v12a.5.5 0 0 1-.053.224l-.5 1a.5.5 0 0 1-.8.13L13 14.707l-.646.647a.5.5 0 0 1-.708 0L11 14.707l-.646.647a.5.5 0 0 1-.708 0L9 14.707l-.646.647a.5.5 0 0 1-.708 0L7 14.707l-.646.647a.5.5 0 0 1-.708 0L5 14.707l-.646.647a.5.5 0 0 1-.708 0L3 14.707l-.646.647a.5.5 0 0 1-.801-.13l-.5-1A.5.5 0 0 1 1 14V2a.5.5 0 0 1 .053-.224l.5-1a.5.5 0 0 1 .367-.27zm.217 1.338L2 2.118v11.764l.137.274.51-.51a.5.5 0 0 1 .707 0l.646.647.646-.646a.5.5 0 0 1 .708 0l.646.646.646-.646a.5.5 0 0 1 .708 0l.646.646.646-.646a.5.5 0 0 1 .708 0l.646.646.646-.646a.5.5 0 0 1 .708 0l.646.646.646-.646a.5.5 0 0 1 .708 0l.509.509.137-.274V2.118l-.137-.274-.51.51a.5.5 0 0 1-.707 0L12 1.707l-.646.647a.5.5 0 0 1-.708 0L10 1.707l-.646.647a.5.5 0 0 1-.708 0L8 1.707l-.646.647a.5.5 0 0 1-.708 0L6 1.707l-.646.647a.5.5 0 0 1-.708 0L4 1.707l-.646.647a.5.5 0 0 1-.708 0l-.509-.51z"
              />
              <path
                d="M3 4.5a.5.5 0 0 1 .5-.5h6a.5.5 0 1 1 0 1h-6a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h6a.5.5 0 1 1 0 1h-6a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h6a.5.5 0 1 1 0 1h-6a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5zm8-6a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5z"
              />
            </svg>
            <strong>&nbsp;Stockers</strong>
            <a href="/logout" class="text-light">Logout</a>
          </a>
        </div>
      </div>
    </header>

    <main>
      <section class="py-5 text-center container">
        <div class="row py-lg-5">
          <div class="col-lg-6 col-md-8 mx-auto">
            <h1 class="fw-light">Buy Stock Now!</h1>
            <p class="lead text-muted">
              Our products are some of the highest quality products about. Our on-demand customer support will help you at every stage,
              helping you make money and win your customers over.
            </p>
            <p>
              <a href="#" class="btn btn-primary my-2" data-bs-toggle="modal" data-bs-target="#cart-modal">View Cart</a>
            </p>
          </div>
        </div>
      </section>

      <div class="album py-5 bg-light">
        <div class="container">
          <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3" id="item-container"></div>
        </div>
      </div>
    </main>

    <footer class="text-muted py-5">
      <div class="container">
        <p class="float-end mb-1">
          <a href="#">Back to top</a>
        </p>
      </div>
    </footer>

    <template id="product-template">
      <div class="col">
        <div class="card shadow-sm">
          <img width="100%" height="100%" class="card-img-top item-image" src="" />

          <div class="card-body">
            <p class="card-text">
              <strong class="item-title"></strong><br />
              <span class="item-description"> </span>
            </p>
            <small class="text-muted item-stock"></small>

            <div class="d-flex justify-content-between align-items-center">
              <small class="text-muted item-price"></small>
              <div class="btn-group">
                <button type="button" class="btn btn-sm btn-outline-secondary add-to-basket">Add to Basket</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </template>

    <template id="basket-template">
      <tr class="basket-item">
        <td class="item-name"></td>
        <td class="item-price"></td>
        <td class="item-quantity"></td>
      </tr>
    </template>

    <div class="modal" id="cart-modal" tabindex="-1">
      <div class="modal-dialog modal-xl">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Your Cart</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div id="before-purchase">
              <table class="table table-striped">
                <thead>
                  <tr>
                    <th scope="col">Item</th>
                    <th scope="col">Price (£)</th>
                    <th scope="col">Quantity</th>
                  </tr>
                </thead>
                <tbody id="cart-table">
                  <tr>
                    <th scope="col">Total</th>
                    <th scope="col" id="cart-total"></th>
                    <th scope="col"></th>
                  </tr>
                </tbody>
              </table>
            </div>
            <div id="after-purchase" style="display: none">
              <h1>Thank you for your purchase!</h1>
              <p><strong>Order ID: </strong><span id="order-id"></span></p>
              <p>
                Your order details have been emailed to you. You can view the purchase order
                <a id="purchase-order-link" target="_blank" rel="noopener">here.</a>
              </p>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" id="submit-purchase">Submit Purchase</button>

            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
  </body>

  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
    crossorigin="anonymous"
  ></script>

  <script>
    const $ = (selector) => document.querySelector(selector);

    const basket = [];

    let productStore = [];

    const cartModalElement = $("#cart-modal");
    const cartModal = new bootstrap.Modal(cartModalElement);

    fetch("/api/products")
      .then((response) => response.json())
      .then((products) => {
        productStore = products;
        const template = $("#product-template");

        products.forEach((product) => {
          const clone = template.content.cloneNode(true);
          const $$ = (selector) => clone.querySelector(selector);

          $$(".item-title").textContent = product.title;
          $$(".item-description").textContent = product.description;
          $$(".item-price").textContent = `£${product.price.toFixed(2)}`;
          $$(".item-stock").textContent = `${product.currentStock} In Stock`;
          $$(".item-image").setAttribute("src", `/static/img/${product.image}`);
          $$(".add-to-basket").setAttribute("product-id", product._id);

          $("#item-container").appendChild(clone);
        });

        Array.from(document.querySelectorAll(".add-to-basket")).forEach((button) => {
          button.addEventListener("click", () => {
            const product = productStore.find((product) => product._id === button.getAttribute("product-id"));

            if (!product) return;

            const existing = basket.find((basketItem) => basketItem._id === product._id);
            if (existing) {
              existing.amount++;
            } else {
              basket.push({ ...product, amount: 1 });
            }

            alert("Added to basket!");
            console.log(basket);
          });
        });
      });

    const beforePurchase = $("#before-purchase");
    const afterPurchase = $("#after-purchase");
    const cartTable = $("#cart-table");
    const submitPurchase = $("#submit-purchase");

    const purchaseOrderLink = $("#purchase-order-link");

    cartModalElement.addEventListener("show.bs.modal", () => {
      beforePurchase.style.display = "";
      afterPurchase.style.display = "none";

      document.querySelectorAll(".basket-item").forEach((item) => item.remove());

      const template = $("#basket-template");

      basket.forEach((basketItem) => {
        const clone = template.content.cloneNode(true);

        const $$ = (selector) => clone.querySelector(selector);

        $$(".item-name").textContent = basketItem.title;

        $$(".item-quantity").textContent = basketItem.amount;
        $$(".item-price").textContent = `£${basketItem.price.toFixed(2)}`;

        cartTable.prepend(clone);
      });

      $("#cart-total").textContent = basket
        .map((x) => x.price * x.amount)
        .reduce((a, b) => a + b, 0)
        .toFixed(2);

      if (basket.length > 0) {
        submitPurchase.style.display = "";
      } else {
        submitPurchase.style.display = "none";
      }
    });

    submitPurchase.addEventListener("click", () => {
      fetch("/api/order", {
        method: "POST",
        body: JSON.stringify({ basket }),
        headers: {
          "Content-Type": "application/json",
        },
      })
        .then((response) => response.json())
        .then((response) => {
          if (!response.success) return alert("Something went wrong processing your order!");

          purchaseOrderLink.setAttribute("href", `/api/po/${response.orderId}`);

          $("#order-id").textContent = response.orderId;

          beforePurchase.style.display = "none";
          afterPurchase.style.display = "";
          submitPurchase.style.display = "none";
        });
    });
  </script>
</html>
